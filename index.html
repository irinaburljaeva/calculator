<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>ШАГАЙ ДОМА — калькуляторы</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    :root {
      --red: #CF2C02;
      --yellow: #FFBA08;
      --bg: #FFFFFF;
      --ink: #111111;
      --soft: #6B6B6B;
      --border: #E5E5E5;
      --radius: 22px;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #FFF3E0 0, #FFFFFF 55%);
      color: var(--ink);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .page {
      width: 100%;
      max-width: 900px;
      padding: 40px 16px 48px;
    }

    .title {
      font-size: 24px;
      font-weight: 700;
      text-align: center;
      letter-spacing: 0.03em;
      margin-bottom: 6px;
    }

    .subtitle {
      text-align: center;
      font-size: 13px;
      color: var(--soft);
      margin-bottom: 28px;
    }

    .menu {
      display: grid;
      grid-template-columns: 1fr 1fr; /* даже на телефоне слева/справа */
      gap: 14px;
    }

    @media (max-width: 480px) {
      .page {
        padding-top: 32px;
      }
    }

    .menu-card {
      border-radius: var(--radius);
      border: 1px solid var(--border);
      padding: 20px 18px;
      background: #fff;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      justify-content: center;
      gap: 6px;
      min-height: 112px;
      outline: none;
      transition: border-color 0.14s ease-out,
                  box-shadow 0.14s ease-out,
                  transform 0.14s ease-out,
                  background 0.14s ease-out;
      box-shadow: 0 10px 28px rgba(0,0,0,0.04);
    }

    .menu-card span {
      font-size: 12px;
      color: var(--soft);
      font-weight: 400;
    }

    .menu-card--bmi {
      border-color: rgba(207,44,2,0.25);
      background: linear-gradient(135deg, #FFFFFF, #FFF4ED);
    }

    .menu-card--cal {
      border-color: rgba(255,186,8,0.6);
      background: linear-gradient(135deg, #FFFFFF, #FFFBEA);
    }

    .menu-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 18px 40px rgba(0,0,0,0.12);
    }

    .menu-card--bmi:hover {
      background: linear-gradient(135deg, #FFF7F2, #FFE4D6);
    }

    .menu-card--cal:hover {
      background: linear-gradient(135deg, #FFFDF1, #FFEEC4);
    }

    /* МОДАЛКИ */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.35);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 10px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.15s ease-out;
      z-index: 30;
    }

    .modal--active {
      opacity: 1;
      pointer-events: auto;
    }

    .modal__dialog {
      width: 100%;
      max-width: 520px;
      max-height: 100%;
      background: #fff;
      border-radius: 24px;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      box-shadow: 0 24px 60px rgba(0,0,0,0.25);
    }

    .modal__head {
      padding: 10px 14px;
      border-bottom: 1px solid #F1F1F1;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      background: linear-gradient(135deg, #FFFFFF 0%, #FFF4D1 45%, #FFE0CF 100%);
    }

    .modal__title {
      font-size: 16px;
      font-weight: 650;
    }

    .modal__close {
      border-radius: 999px;
      border: none;
      background: #FFFFFF;
      width: 30px;
      height: 30px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 18px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.12);
    }

    .modal__body {
      padding: 12px 14px 14px;
      overflow-y: auto;
      font-size: 14px;
    }

    .row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 10px;
    }

    @media (max-width: 480px) {
      .row {
        grid-template-columns: 1fr;
      }
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .field label {
      font-size: 13px;
    }

    .field input,
    .field select {
      border-radius: 999px;
      border: 1px solid var(--border);
      padding: 7px 10px;
      font-size: 14px;
      font-family: inherit;
      outline: none;
      background: #FAFAFA;
    }

    .field input:focus,
    .field select:focus {
      border-color: var(--red);
      background: #FFFFFF;
    }

    .field small {
      font-size: 11px;
      color: var(--soft);
    }

    .btn {
      border-radius: 999px;
      padding: 8px 14px;
      border: none;
      font-size: 13px;
      cursor: pointer;
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .btn--red {
      background: var(--red);
      color: #fff;
      box-shadow: 0 10px 24px rgba(207,44,2,0.4);
    }

    .btn--red:hover {
      transform: translateY(-1px);
      box-shadow: 0 14px 30px rgba(207,44,2,0.55);
    }

    .btn--gray {
      background: #F3F3F3;
      color: var(--soft);
    }

    .btns {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
      margin-bottom: 8px;
    }

    .error {
      font-size: 12px;
      color: #C81E1E;
      margin-top: 4px;
    }

    .box {
      border-radius: 12px;
      border: 1px solid #FFF0C2;
      background: #FFF9E7;
      padding: 8px 10px;
      font-size: 13px;
      margin-top: 8px;
    }

    .box strong {
      color: var(--red);
    }

    .divider {
      height: 1px;
      background: #F1F1F1;
      margin: 10px 0;
    }

    .food-list {
      margin-top: 6px;
      font-size: 12px;
      border-radius: 10px;
      border: 1px solid #F0F0F0;
      padding: 6px 8px;
      max-height: 180px;
      overflow-y: auto;
    }

    .food-row {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      padding: 3px 0;
      border-bottom: 1px dashed #ECECEC;
    }

    .food-row:last-child {
      border-bottom: none;
    }

    .food-name {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .food-kcal {
      font-weight: 500;
    }

    .summary {
      font-size: 13px;
      margin-top: 6px;
    }

    .summary strong {
      color: var(--red);
    }

    /* ТАБЫ внутри калькулятора калорий */
    .tabs {
      margin-bottom: 10px;
    }

    .tabs-switch {
      display: flex;
      gap: 4px;
      padding: 4px;
      border-radius: 999px;
      background: #F3F3F3;
    }

    .tab-btn {
      flex: 1;
      border-radius: 999px;
      border: none;
      background: transparent;
      padding: 6px 8px;
      font-size: 12px;
      cursor: pointer;
      font-weight: 500;
      color: var(--soft);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
    }

    .tab-btn span {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.06em;
    }

    .tab-btn--active {
      background: linear-gradient(135deg, var(--red), #E85D04);
      color: #FFFFFF;
      box-shadow: 0 10px 24px rgba(207,44,2,0.45);
    }

    .tab-content {
      display: none;
      animation: fadeIn 0.12s ease-out;
    }

    .tab-content--active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(2px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="title">ШАГАЙ ДОМА — калькуляторы</div>
    <div class="subtitle">Быстро посчитать ИМТ и свои калории на день — без лишней воды.</div>

    <div class="menu">
      <button class="menu-card menu-card--bmi" data-modal-target="modal-bmi">
        ИМТ
        <span>быстрая оценка веса</span>
      </button>
      <button class="menu-card menu-card--cal" data-modal-target="modal-cal">
        Калории / КБЖУ
        <span>норма и калории за день</span>
      </button>
    </div>
  </div>

  <!-- МОДАЛ: ИМТ -->
  <div class="modal" id="modal-bmi">
    <div class="modal__dialog">
      <div class="modal__head">
        <div class="modal__title">Калькулятор ИМТ</div>
        <button class="modal__close" type="button" data-modal-close>✕</button>
      </div>
      <div class="modal__body">
        <form id="bmiForm">
          <div class="row">
            <div class="field">
              <label for="bmiWeight">Вес, кг</label>
              <input id="bmiWeight" type="number" step="0.1" min="30" max="250" required>
            </div>
            <div class="field">
              <label for="bmiHeight">Рост, см</label>
              <input id="bmiHeight" type="number" step="1" min="120" max="220" required>
            </div>
          </div>
          <div class="btns">
            <button class="btn btn--red" type="submit">Рассчитать</button>
            <button class="btn btn--gray" type="button" id="bmiReset">Сброс</button>
          </div>
          <div id="bmiError" class="error" style="display:none;"></div>
          <div id="bmiResult" class="box" style="display:none;"></div>
        </form>
      </div>
    </div>
  </div>

  <!-- МОДАЛ: КАЛОРИИ -->
  <div class="modal" id="modal-cal">
    <div class="modal__dialog">
      <div class="modal__head">
        <div class="modal__title">Калории и КБЖУ</div>
        <button class="modal__close" type="button" data-modal-close>✕</button>
      </div>
      <div class="modal__body">

        <!-- Табы -->
        <div class="tabs">
          <div class="tabs-switch">
            <button
              class="tab-btn tab-btn--active"
              type="button"
              data-cal-tab="norm"
            >
              Ваша норма
              <span>ккал / день</span>
            </button>
            <button
              class="tab-btn"
              type="button"
              data-cal-tab="day"
            >
              Калории за день
              <span>что вы съели</span>
            </button>
          </div>
        </div>

        <!-- Вкладка: Ваша норма -->
        <div class="tab-content tab-content--active" data-cal-content="norm">
          <form id="normForm">
            <div class="row">
              <div class="field">
                <label for="sex">Пол</label>
                <select id="sex" required>
                  <option value="female" selected>Женщина</option>
                  <option value="male">Мужчина</option>
                </select>
              </div>
              <div class="field">
                <label for="age">Возраст</label>
                <input id="age" type="number" min="16" max="90" required>
              </div>
            </div>
            <div class="row">
              <div class="field">
                <label for="weight">Вес, кг</label>
                <input id="weight" type="number" step="0.1" min="40" max="250" required>
              </div>
              <div class="field">
                <label for="height">Рост, см</label>
                <input id="height" type="number" step="1" min="140" max="220" required>
              </div>
            </div>
            <div class="row">
              <div class="field">
                <label for="activity">Активность</label>
                <select id="activity" required>
                  <option value="1.2">Сидячий день</option>
                  <option value="1.375">Лёгкие тренировки</option>
                  <option value="1.55" selected>3–5 тренировок в неделю</option>
                  <option value="1.725">Очень активный день</option>
                </select>
              </div>
              <div class="field">
                <label for="goal">Цель</label>
                <select id="goal" required>
                  <option value="loss" selected>Похудеть</option>
                  <option value="maintain">Держать вес</option>
                  <option value="gain">Набирать</option>
                </select>
              </div>
            </div>
            <div class="btns">
              <button class="btn btn--red" type="submit">Рассчитать норму</button>
              <button class="btn btn--gray" type="button" id="normReset">Сброс</button>
            </div>
            <div id="normError" class="error" style="display:none;"></div>
            <div id="normResult" class="box" style="display:none;"></div>
          </form>
        </div>

        <!-- Вкладка: Калории за день -->
        <div class="tab-content" data-cal-content="day">
          <form id="foodForm">
            <div class="row">
              <div class="field">
                <label for="foodName">Продукт</label>
                <input id="foodName" type="text" list="foodOptions" placeholder="яблоко, банан, гречка…" required>
                <datalist id="foodOptions">
                  <option value="Яблоко">
                  <option value="Банан">
                  <option value="Гречка варёная">
                  <option value="Овсянка на воде">
                  <option value="Куриная грудка без кожи">
                  <option value="Йогурт натуральный 2%">
                  <option value="Творог 5%">
                  <option value="Яйцо куриное">
                  <option value="Сыр твёрдый">
                  <option value="Огурец">
                  <option value="Помидор">
                  <option value="Рис отварной">
                </datalist>
              </div>
            </div>
            <div class="row">
              <div class="field">
                <label for="foodAmount">Количество, г</label>
                <input id="foodAmount" type="number" min="1" step="1" required>
              </div>
              <div class="field">
                <label for="foodPer100">Ккал на 100 г (если знаете)</label>
                <input id="foodPer100" type="number" min="0" step="1" placeholder="опционально">
                <small>Если продукт есть в списке, подставим автоматически.</small>
              </div>
            </div>
            <div class="btns">
              <button class="btn btn--red" type="submit">Добавить</button>
              <button class="btn btn--gray" type="button" id="foodReset">Очистить день</button>
            </div>
            <div id="foodError" class="error" style="display:none;"></div>
          </form>

          <div id="foodList" class="food-list" style="display:none;"></div>
          <div id="foodSummary" class="summary" style="display:none;"></div>

          <div class="divider"></div>
          <div class="summary" style="font-size:11px;color:#8A8A8A;">
            * Если вы уже посчитали свою норму калорий во вкладке «Ваша норма»,
            здесь будет показан процент от неё и сколько ккал осталось или перебор.
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ---------- общая логика модалок ----------
    document.querySelectorAll('.menu-card').forEach(card => {
      card.addEventListener('click', () => {
        const id = card.getAttribute('data-modal-target');
        const modal = document.getElementById(id);
        if (modal) modal.classList.add('modal--active');
      });
    });

    document.querySelectorAll('[data-modal-close]').forEach(btn => {
      btn.addEventListener('click', () => {
        const modal = btn.closest('.modal');
        if (modal) modal.classList.remove('modal--active');
      });
    });

    document.querySelectorAll('.modal').forEach(modal => {
      modal.addEventListener('click', (e) => {
        if (e.target === modal) modal.classList.remove('modal--active');
      });
    });

    // ---------- ИМТ ----------
    const bmiForm = document.getElementById('bmiForm');
    const bmiError = document.getElementById('bmiError');
    const bmiResult = document.getElementById('bmiResult');
    const bmiReset = document.getElementById('bmiReset');

    function bmiStatus(bmi) {
      if (bmi < 18.5) return 'дефицит массы';
      if (bmi < 25) return 'норма';
      if (bmi < 30) return 'избыточный вес';
      return 'ожирение';
    }

    bmiForm.addEventListener('submit', (e) => {
      e.preventDefault();
      bmiError.style.display = 'none';
      bmiResult.style.display = 'none';

      const w = parseFloat(document.getElementById('bmiWeight').value.replace(',', '.'));
      const hCm = parseFloat(document.getElementById('bmiHeight').value.replace(',', '.'));

      if (!w || !hCm || w <= 0 || hCm <= 0) {
        bmiError.textContent = 'Проверьте вес и рост.';
        bmiError.style.display = 'block';
        return;
      }

      const h = hCm / 100;
      const bmi = w / (h * h);
      const s = bmiStatus(bmi);

      bmiResult.innerHTML = `ИМТ: <strong>${bmi.toFixed(1)}</strong> — ${s}.`;
      bmiResult.style.display = 'block';
    });

    bmiReset.addEventListener('click', () => {
      bmiForm.reset();
      bmiError.style.display = 'none';
      bmiResult.style.display = 'none';
    });

    // ---------- КАЛОРИИ: НОРМА ----------
    let dailyNorm = null; // используется и во вкладке "Калории за день"

    const normForm = document.getElementById('normForm');
    const normError = document.getElementById('normError');
    const normResult = document.getElementById('normResult');
    const normReset = document.getElementById('normReset');

    function calcBMR(sex, weight, height, age) {
      // Миффлин–Сан Жеор
      if (sex === 'female') {
        return 10 * weight + 6.25 * height - 5 * age - 161;
      } else {
        return 10 * weight + 6.25 * height - 5 * age + 5;
      }
    }

    normForm.addEventListener('submit', (e) => {
      e.preventDefault();
      normError.style.display = 'none';
      normResult.style.display = 'none';

      const sex = document.getElementById('sex').value;
      const age = parseInt(document.getElementById('age').value, 10);
      const weight = parseFloat(document.getElementById('weight').value.replace(',', '.'));
      const height = parseFloat(document.getElementById('height').value.replace(',', '.'));
      const activity = parseFloat(document.getElementById('activity').value);
      const goal = document.getElementById('goal').value;

      if (!age || !weight || !height || age <= 0 || weight <= 0 || height <= 0) {
        normError.textContent = 'Проверьте введённые данные.';
        normError.style.display = 'block';
        return;
      }

      const bmr = calcBMR(sex, weight, height, age);
      let tdee = bmr * activity;

      if (goal === 'loss') tdee *= 0.85;
      if (goal === 'gain') tdee *= 1.15;

      dailyNorm = Math.round(tdee);

      let txtGoal = 'поддержания веса';
      if (goal === 'loss') txtGoal = 'похудения';
      if (goal === 'gain') txtGoal = 'набора массы';

      normResult.innerHTML = `Ориентир для <strong>${txtGoal}</strong>: <strong>${dailyNorm} ккал</strong> в день.`;
      normResult.style.display = 'block';

      // обновим сводку по еде, если уже есть записи
      updateFoodSummary();
    });

    normReset.addEventListener('click', () => {
      normForm.reset();
      normError.style.display = 'none';
      normResult.style.display = 'none';
      dailyNorm = null;
      updateFoodSummary();
    });

    // ---------- БАЗА ПРОДУКТОВ ----------
    const FOOD_DB = {
      'яблоко': 52,
      'банан': 89,
      'гречка вареная': 110,
      'гречка варёная': 110,
      'овсянка на воде': 68,
      'куриная грудка без кожи': 165,
      'йогурт натуральный 2%': 60,
      'творог 5%': 120,
      'яйцо куриное': 155,
      'сыр твердый': 350,
      'сыр твёрдый': 350,
      'огурец': 15,
      'помидор': 18,
      'рис отварной': 120
    };

    function normName(str) {
      return str
        .toLowerCase()
        .replace(/ё/g, 'е')
        .trim();
    }

    // ---------- КАЛОРИИ: КАЛОРИИ ЗА ДЕНЬ ----------
    const foodForm = document.getElementById('foodForm');
    const foodList = document.getElementById('foodList');
    const foodSummary = document.getElementById('foodSummary');
    const foodReset = document.getElementById('foodReset');
    const foodError = document.getElementById('foodError');

    let foods = []; // { name, kcal, grams }

    function renderFoodList() {
      if (!foods.length) {
        foodList.style.display = 'none';
        foodList.innerHTML = '';
        return;
      }
      foodList.style.display = 'block';
      foodList.innerHTML = foods.map(item => `
        <div class="food-row">
          <div class="food-name">${item.name} — ${item.grams} г</div>
          <div class="food-kcal">${item.kcal} ккал</div>
        </div>
      `).join('');
    }

    function updateFoodSummary() {
      if (!foods.length) {
        foodSummary.style.display = 'none';
        foodSummary.innerHTML = '';
        return;
      }
      const total = foods.reduce((sum, item) => sum + item.kcal, 0);
      let html = `Всего за день: <strong>${total} ккал</strong>.`;

      if (dailyNorm && dailyNorm > 0) {
        const percent = (total / dailyNorm) * 100;
        const left = dailyNorm - total;
        const sign = left >= 0 ? 'осталось' : 'перебор';
        const absLeft = Math.abs(left);
        html += ` Это <strong>${percent.toFixed(0)}%</strong> от вашей нормы, ${sign} примерно <strong>${absLeft} ккал</strong>.`;
      }

      foodSummary.innerHTML = html;
      foodSummary.style.display = 'block';
    }

    foodForm.addEventListener('submit', (e) => {
      e.preventDefault();
      foodError.style.display = 'none';
      foodError.textContent = '';

      const nameInput = document.getElementById('foodName');
      const amountInput = document.getElementById('foodAmount');
      const per100Input = document.getElementById('foodPer100');

      const name = nameInput.value.trim();
      const grams = parseInt(amountInput.value, 10);
      const per100Manual = parseInt(per100Input.value, 10);

      if (!name || !grams || grams <= 0) {
        return;
      }

      let per100 = NaN;

      if (per100Manual && per100Manual > 0) {
        per100 = per100Manual;
      } else {
        const key = normName(name);
        if (FOOD_DB[key]) {
          per100 = FOOD_DB[key];
        }
      }

      if (!per100 || per100 <= 0) {
        foodError.textContent = 'Не нашли калорийность этого продукта. Введите «ккал на 100 г» и попробуйте ещё раз.';
        foodError.style.display = 'block';
        return;
      }

      const kcal = Math.round(per100 * grams / 100);

      foods.push({ name, grams, kcal });

      nameInput.value = '';
      amountInput.value = '';
      // не очищаем per100, чтобы можно было добавлять похожие продукты подряд

      renderFoodList();
      updateFoodSummary();
    });

    foodReset.addEventListener('click', () => {
      foods = [];
      renderFoodList();
      updateFoodSummary();
      foodError.style.display = 'none';
      foodError.textContent = '';
    });

    // ---------- Переключение табов в калькуляторе калорий ----------
    const tabButtons = document.querySelectorAll('[data-cal-tab]');
    const tabContents = document.querySelectorAll('[data-cal-content]');

    function setCalTab(mode) {
      tabButtons.forEach(btn => {
        btn.classList.toggle('tab-btn--active', btn.getAttribute('data-cal-tab') === mode);
      });
      tabContents.forEach(block => {
        block.classList.toggle('tab-content--active', block.getAttribute('data-cal-content') === mode);
      });
    }

    tabButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        const mode = btn.getAttribute('data-cal-tab');
        setCalTab(mode);
      });
    });
  </script>
</body>
</html>
