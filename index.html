<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>ШАГАЙ ДОМА — калькуляторы</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    :root {
      --red: #CF2C02;
      --yellow: #FFBA08;
      --bg: #FFFFFF;
      --ink: #111111;
      --soft: #6B6B6B;
      --border: #E5E5E5;
      --radius: 18px;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--ink);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .page {
      width: 100%;
      max-width: 720px;
      padding: 16px;
    }

    .title {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 14px;
      text-align: center;
    }

    .menu {
      display: grid;
      grid-template-columns: 1fr 1fr; /* даже на телефоне слева/справа */
      gap: 10px;
    }

    .menu-card {
      border-radius: var(--radius);
      border: 1px solid var(--border);
      padding: 16px 10px;
      background: #fff;
      text-align: center;
      cursor: pointer;
      font-size: 15px;
      font-weight: 600;
      display: flex;
      flex-direction: column;
      justify-content: center;
      gap: 4px;
      min-height: 96px;
      outline: none;
      transition: border-color 0.12s ease-out, box-shadow 0.12s ease-out, transform 0.12s ease-out;
    }

    .menu-card span {
      font-size: 11px;
      color: var(--soft);
      font-weight: 400;
    }

    .menu-card--bmi {
      border-color: rgba(207,44,2,0.25);
    }

    .menu-card--bmi:hover {
      box-shadow: 0 10px 24px rgba(207,44,2,0.18);
      transform: translateY(-1px);
    }

    .menu-card--cal {
      border-color: rgba(255,186,8,0.6);
    }

    .menu-card--cal:hover {
      box-shadow: 0 10px 24px rgba(255,186,8,0.25);
      transform: translateY(-1px);
    }

    /* МОДАЛКИ */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.35);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 10px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.15s ease-out;
      z-index: 30;
    }

    .modal--active {
      opacity: 1;
      pointer-events: auto;
    }

    .modal__dialog {
      width: 100%;
      max-width: 520px;
      max-height: 100%;
      background: #fff;
      border-radius: 20px;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .modal__head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 14px;
      border-bottom: 1px solid #F1F1F1;
    }

    .modal__title {
      font-size: 16px;
      font-weight: 600;
    }

    .modal__close {
      border-radius: 999px;
      border: none;
      background: #F3F3F3;
      width: 30px;
      height: 30px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 18px;
    }

    .modal__body {
      padding: 12px 14px 14px;
      overflow-y: auto;
      font-size: 14px;
    }

    .row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 10px;
    }

    @media (max-width: 480px) {
      .row {
        grid-template-columns: 1fr;
      }
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .field label {
      font-size: 13px;
    }

    .field input,
    .field select {
      border-radius: 999px;
      border: 1px solid var(--border);
      padding: 7px 10px;
      font-size: 14px;
      font-family: inherit;
      outline: none;
    }

    .field input:focus,
    .field select:focus {
      border-color: var(--red);
    }

    .btn {
      border-radius: 999px;
      padding: 8px 14px;
      border: none;
      font-size: 13px;
      cursor: pointer;
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .btn--red {
      background: var(--red);
      color: #fff;
    }

    .btn--gray {
      background: #F3F3F3;
      color: var(--soft);
    }

    .btns {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
      margin-bottom: 8px;
    }

    .error {
      font-size: 12px;
      color: #C81E1E;
      margin-top: 4px;
    }

    .box {
      border-radius: 12px;
      border: 1px solid #FFF0C2;
      background: #FFF9E7;
      padding: 8px 10px;
      font-size: 13px;
      margin-top: 8px;
    }

    .box strong {
      color: var(--red);
    }

    .divider {
      height: 1px;
      background: #F1F1F1;
      margin: 10px 0;
    }

    .section-title {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      border-radius: 999px;
      padding: 2px 8px;
      border: 1px solid #FFE18C;
      background: #FFF9E7;
      color: #A36A00;
    }

    .food-list {
      margin-top: 6px;
      font-size: 12px;
      border-radius: 10px;
      border: 1px solid #F0F0F0;
      padding: 6px 8px;
      max-height: 180px;
      overflow-y: auto;
    }

    .food-row {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      padding: 3px 0;
      border-bottom: 1px dashed #ECECEC;
    }

    .food-row:last-child {
      border-bottom: none;
    }

    .food-name {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .food-kcal {
      font-weight: 500;
    }

    .summary {
      font-size: 13px;
      margin-top: 6px;
    }

    .summary strong {
      color: var(--red);
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="title">ШАГАЙ ДОМА — калькуляторы</div>

    <div class="menu">
      <button class="menu-card menu-card--bmi" data-modal-target="modal-bmi">
        ИМТ
        <span>быстрая оценка веса</span>
      </button>
      <button class="menu-card menu-card--cal" data-modal-target="modal-cal">
        Калории / КБЖУ
        <span>норма и что вы съели</span>
      </button>
    </div>
  </div>

  <!-- МОДАЛ: ИМТ -->
  <div class="modal" id="modal-bmi">
    <div class="modal__dialog">
      <div class="modal__head">
        <div class="modal__title">Калькулятор ИМТ</div>
        <button class="modal__close" type="button" data-modal-close>✕</button>
      </div>
      <div class="modal__body">
        <form id="bmiForm">
          <div class="row">
            <div class="field">
              <label for="bmiWeight">Вес, кг</label>
              <input id="bmiWeight" type="number" step="0.1" min="30" max="250" required>
            </div>
            <div class="field">
              <label for="bmiHeight">Рост, см</label>
              <input id="bmiHeight" type="number" step="1" min="120" max="220" required>
            </div>
          </div>
          <div class="btns">
            <button class="btn btn--red" type="submit">Рассчитать</button>
            <button class="btn btn--gray" type="button" id="bmiReset">Сброс</button>
          </div>
          <div id="bmiError" class="error" style="display:none;"></div>
          <div id="bmiResult" class="box" style="display:none;"></div>
        </form>
      </div>
    </div>
  </div>

  <!-- МОДАЛ: КАЛОРИИ -->
  <div class="modal" id="modal-cal">
    <div class="modal__dialog">
      <div class="modal__head">
        <div class="modal__title">Калории и КБЖУ</div>
        <button class="modal__close" type="button" data-modal-close>✕</button>
      </div>
      <div class="modal__body">
        <!-- БЛОК 1 — НОРМА -->
        <div class="section-title">
          Норма в день
          <span class="pill">расчёт по параметрам</span>
        </div>
        <form id="normForm">
          <div class="row">
            <div class="field">
              <label for="sex">Пол</label>
              <select id="sex" required>
                <option value="female" selected>Женщина</option>
                <option value="male">Мужчина</option>
              </select>
            </div>
            <div class="field">
              <label for="age">Возраст</label>
              <input id="age" type="number" min="16" max="90" required>
            </div>
          </div>
          <div class="row">
            <div class="field">
              <label for="weight">Вес, кг</label>
              <input id="weight" type="number" step="0.1" min="40" max="250" required>
            </div>
            <div class="field">
              <label for="height">Рост, см</label>
              <input id="height" type="number" step="1" min="140" max="220" required>
            </div>
          </div>
          <div class="row">
            <div class="field">
              <label for="activity">Активность</label>
              <select id="activity" required>
                <option value="1.2">Сидячий день</option>
                <option value="1.375">Лёгкие тренировки</option>
                <option value="1.55" selected>3–5 тренировок в неделю</option>
                <option value="1.725">Очень активный день</option>
              </select>
            </div>
            <div class="field">
              <label for="goal">Цель</label>
              <select id="goal" required>
                <option value="loss" selected>Похудеть</option>
                <option value="maintain">Держать вес</option>
                <option value="gain">Набирать</option>
              </select>
            </div>
          </div>
          <div class="btns">
            <button class="btn btn--red" type="submit">Рассчитать норму</button>
            <button class="btn btn--gray" type="button" id="normReset">Сброс</button>
          </div>
          <div id="normError" class="error" style="display:none;"></div>
          <div id="normResult" class="box" style="display:none;"></div>
        </form>

        <div class="divider"></div>

        <!-- БЛОК 2 — ЧТО Я СЪЕЛА -->
        <div class="section-title">
          Что я съела
          <span class="pill">дневник за день</span>
        </div>
        <form id="foodForm">
          <div class="row">
            <div class="field">
              <label for="foodName">Продукт</label>
              <input id="foodName" type="text" placeholder="йогурт, яблоко…" required>
            </div>
            <div class="field">
              <label for="foodKcal">Калории, ккал</label>
              <input id="foodKcal" type="number" min="0" step="1" required>
            </div>
          </div>
          <div class="btns">
            <button class="btn btn--red" type="submit">Добавить</button>
            <button class="btn btn--gray" type="button" id="foodReset">Очистить день</button>
          </div>
        </form>

        <div id="foodList" class="food-list" style="display:none;"></div>
        <div id="foodSummary" class="summary" style="display:none;"></div>
      </div>
    </div>
  </div>

  <script>
    // ---------- общая логика модалок ----------
    document.querySelectorAll('.menu-card').forEach(card => {
      card.addEventListener('click', () => {
        const id = card.getAttribute('data-modal-target');
        const modal = document.getElementById(id);
        if (modal) modal.classList.add('modal--active');
      });
    });

    document.querySelectorAll('[data-modal-close]').forEach(btn => {
      btn.addEventListener('click', () => {
        const modal = btn.closest('.modal');
        if (modal) modal.classList.remove('modal--active');
      });
    });

    document.querySelectorAll('.modal').forEach(modal => {
      modal.addEventListener('click', (e) => {
        if (e.target === modal) modal.classList.remove('modal--active');
      });
    });

    // ---------- ИМТ ----------
    const bmiForm = document.getElementById('bmiForm');
    const bmiError = document.getElementById('bmiError');
    const bmiResult = document.getElementById('bmiResult');
    const bmiReset = document.getElementById('bmiReset');

    function bmiStatus(bmi) {
      if (bmi < 18.5) return 'дефицит массы';
      if (bmi < 25) return 'норма';
      if (bmi < 30) return 'избыточный вес';
      return 'ожирение';
    }

    bmiForm.addEventListener('submit', (e) => {
      e.preventDefault();
      bmiError.style.display = 'none';
      bmiResult.style.display = 'none';

      const w = parseFloat(document.getElementById('bmiWeight').value.replace(',', '.'));
      const hCm = parseFloat(document.getElementById('bmiHeight').value.replace(',', '.'));

      if (!w || !hCm || w <= 0 || hCm <= 0) {
        bmiError.textContent = 'Проверьте вес и рост.';
        bmiError.style.display = 'block';
        return;
      }

      const h = hCm / 100;
      const bmi = w / (h * h);
      const s = bmiStatus(bmi);

      bmiResult.innerHTML = `ИМТ: <strong>${bmi.toFixed(1)}</strong> — ${s}.`;
      bmiResult.style.display = 'block';
    });

    bmiReset.addEventListener('click', () => {
      bmiForm.reset();
      bmiError.style.display = 'none';
      bmiResult.style.display = 'none';
    });

    // ---------- КАЛОРИИ: НОРМА ----------
    let dailyNorm = null; // будет использоваться в дневнике питания

    const normForm = document.getElementById('normForm');
    const normError = document.getElementById('normError');
    const normResult = document.getElementById('normResult');
    const normReset = document.getElementById('normReset');

    function calcBMR(sex, weight, height, age) {
      // Миффлин-Сан Жеор
      if (sex === 'female') {
        return 10 * weight + 6.25 * height - 5 * age - 161;
      } else {
        return 10 * weight + 6.25 * height - 5 * age + 5;
      }
    }

    normForm.addEventListener('submit', (e) => {
      e.preventDefault();
      normError.style.display = 'none';
      normResult.style.display = 'none';

      const sex = document.getElementById('sex').value;
      const age = parseInt(document.getElementById('age').value, 10);
      const weight = parseFloat(document.getElementById('weight').value.replace(',', '.'));
      const height = parseFloat(document.getElementById('height').value.replace(',', '.'));
      const activity = parseFloat(document.getElementById('activity').value);
      const goal = document.getElementById('goal').value;

      if (!age || !weight || !height || age <= 0 || weight <= 0 || height <= 0) {
        normError.textContent = 'Проверьте введённые данные.';
        normError.style.display = 'block';
        return;
      }

      const bmr = calcBMR(sex, weight, height, age);
      let tdee = bmr * activity;

      if (goal === 'loss') tdee *= 0.85;
      if (goal === 'gain') tdee *= 1.15;

      dailyNorm = Math.round(tdee);

      let txtGoal = 'поддержания веса';
      if (goal === 'loss') txtGoal = 'похудения';
      if (goal === 'gain') txtGoal = 'набора массы';

      normResult.innerHTML = `Ориентир для <strong>${txtGoal}</strong>: <strong>${dailyNorm} ккал</strong> в день.`;
      normResult.style.display = 'block';

      // обновим сводку по еде, если уже что-то добавлено
      updateFoodSummary();
    });

    normReset.addEventListener('click', () => {
      normForm.reset();
      normError.style.display = 'none';
      normResult.style.display = 'none';
      dailyNorm = null;
      updateFoodSummary();
    });

    // ---------- КАЛОРИИ: ЧТО Я СЪЕЛА ----------
    const foodForm = document.getElementById('foodForm');
    const foodList = document.getElementById('foodList');
    const foodSummary = document.getElementById('foodSummary');
    const foodReset = document.getElementById('foodReset');

    let foods = []; // { name, kcal }

    function renderFoodList() {
      if (!foods.length) {
        foodList.style.display = 'none';
        foodList.innerHTML = '';
        return;
      }
      foodList.style.display = 'block';
      foodList.innerHTML = foods.map(item => `
        <div class="food-row">
          <div class="food-name">${item.name}</div>
          <div class="food-kcal">${item.kcal} ккал</div>
        </div>
      `).join('');
    }

    function updateFoodSummary() {
      if (!foods.length) {
        foodSummary.style.display = 'none';
        foodSummary.innerHTML = '';
        return;
      }
      const total = foods.reduce((sum, item) => sum + item.kcal, 0);
      let html = `Всего за день: <strong>${total} ккал</strong>.`;

      if (dailyNorm && dailyNorm > 0) {
        const percent = (total / dailyNorm) * 100;
        const left = dailyNorm - total;
        const sign = left >= 0 ? 'осталось' : 'перебор';
        const absLeft = Math.abs(left);
        html += ` Это <strong>${percent.toFixed(0)}%</strong> от вашей нормы, ${sign} примерно <strong>${absLeft} ккал</strong>.`;
      }

      foodSummary.innerHTML = html;
      foodSummary.style.display = 'block';
    }

    foodForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const nameInput = document.getElementById('foodName');
      const kcalInput = document.getElementById('foodKcal');

      const name = nameInput.value.trim();
      const kcal = parseInt(kcalInput.value, 10);

      if (!name || !kcal || kcal < 0) return;

      foods.push({ name, kcal });
      nameInput.value = '';
      kcalInput.value = '';

      renderFoodList();
      updateFoodSummary();
    });

    foodReset.addEventListener('click', () => {
      foods = [];
      renderFoodList();
      updateFoodSummary();
    });
  </script>
</body>
</html>
